<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>测试下标和字体命令修复</title>
    <style>
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-case {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .latex-input {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            color: #d63384;
        }
        .word-output {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 4px;
            font-family: "Times New Roman", serif;
            margin: 10px 0;
            font-size: 18px;
        }
        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        h1 { color: #333; }
        h2 { color: #666; font-size: 18px; margin-top: 0; }
    </style>
</head>
<body>
    <h1>🔧 修复验证测试</h1>
    <p>测试下标丢失和 \mathbf 字体命令问题是否已修复</p>

    <div class="test-case">
        <h2>测试 1: 矩阵中的下标</h2>
        <div class="latex-input">
            \begin{pmatrix} a_{y}b_{z}-a_{z}b_{y} \\ a_{z}b_{x}-a_{x}b_{z} \\ a_{x}b_{y}-a_{y}b_{x} \end{pmatrix}
        </div>
        <div>期望输出: <code>(■(a_y b_z-a_z b_y@a_z b_x-a_x b_z@a_x b_y-a_y b_x))</code></div>
        <div class="word-output" id="output1">加载中...</div>
        <div class="status" id="status1">测试中...</div>
    </div>

    <div class="test-case">
        <h2>测试 2: \mathbf 字体命令</h2>
        <div class="latex-input">
            \mathbf{a} \times \mathbf{b}
        </div>
        <div>期望输出: <code>a×b</code> (忽略粗体)</div>
        <div class="word-output" id="output2">加载中...</div>
        <div class="status" id="status2">测试中...</div>
    </div>

    <div class="test-case">
        <h2>测试 3: 完整的叉乘公式</h2>
        <div class="latex-input">
            \mathbf{a} \times \mathbf{b} = \begin{pmatrix} a_{y}b_{z}-a_{z}b_{y} \\ a_{z}b_{x}-a_{x}b_{z} \\ a_{x}b_{y}-a_{y}b_{x} \end{pmatrix}
        </div>
        <div>期望输出: <code>a×b=(■(a_y b_z-a_z b_y@a_z b_x-a_x b_z@a_x b_y-a_y b_x))</code></div>
        <div class="word-output" id="output3">加载中...</div>
        <div class="status" id="status3">测试中...</div>
    </div>

    <script src="js/symbol-maps.js"></script>
    <script src="js/latex-utils.js"></script>
    <script src="js/latex-parser.js"></script>
    <script src="js/ast-printer.js"></script>
    <script src="js/postprocessor.js"></script>
    <script src="js/latex-converter.js"></script>

    <script>
        function runTest(testNum, latexInput, expectedSubstrings) {
            try {
                const result = window.latexToWord(latexInput);
                document.getElementById('output' + testNum).textContent = result;
                
                // 检查是否包含期望的子字符串
                let allMatch = true;
                let missingParts = [];
                
                for (const substr of expectedSubstrings) {
                    if (!result.includes(substr)) {
                        allMatch = false;
                        missingParts.push(substr);
                    }
                }
                
                const statusEl = document.getElementById('status' + testNum);
                if (allMatch) {
                    statusEl.textContent = '✅ 测试通过';
                    statusEl.className = 'status success';
                } else {
                    statusEl.textContent = '❌ 测试失败 - 缺少: ' + missingParts.join(', ');
                    statusEl.className = 'status error';
                }
            } catch (e) {
                document.getElementById('output' + testNum).textContent = '错误: ' + e.message;
                document.getElementById('status' + testNum).textContent = '❌ 错误';
                document.getElementById('status' + testNum).className = 'status error';
            }
        }

        // 运行测试
        setTimeout(() => {
            runTest(1, '\\begin{pmatrix} a_{y}b_{z}-a_{z}b_{y} \\\\ a_{z}b_{x}-a_{x}b_{z} \\\\ a_{x}b_{y}-a_{y}b_{x} \\end{pmatrix}', 
                ['a_y', 'b_z', 'a_z', 'b_y', 'a_x', 'b_x']);
            
            runTest(2, '\\mathbf{a} \\times \\mathbf{b}', 
                ['a', '×', 'b']);
            
            runTest(3, '\\mathbf{a} \\times \\mathbf{b} = \\begin{pmatrix} a_{y}b_{z}-a_{z}b_{y} \\\\ a_{z}b_{x}-a_{x}b_{z} \\\\ a_{x}b_{y}-a_{y}b_{x} \\end{pmatrix}', 
                ['a', '×', 'b', '=', 'a_y', 'b_z', 'a_z', 'b_y', 'a_x', 'b_x']);
        }, 100);
    </script>
</body>
</html>
