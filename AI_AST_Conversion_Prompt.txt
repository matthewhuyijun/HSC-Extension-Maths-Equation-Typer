# ğŸ¤– AI Prompt: Rewrite LaTeX-to-Word Conversion Logic Using AST (for Chemistry Equations)

## ğŸ¯ Objective
Revise the existing chemical equation conversion project so that it **uses AST (Abstract Syntax Tree)** instead of Regex-based parsing, while **preserving all visual design, layout, and UI elements**.  
Only the logic related to **Word UnicodeMath conversion** should be rewritten. All other interface features, buttons, and layout must remain *exactly the same* as in the original project.

---

## ğŸ§  Project Context
This project converts mathematical and chemical equations into **Word UnicodeMath format**, so the output can be directly pasted into Microsoft Word Equation Editor and remain fully editable.

Previously, conversion logic relied on **Regex** for token matching. However, this approach caused errors in complex nested expressions like:
```
Fe(OH)3, Ca3(PO4)2, CuSO4Â·5H2O, or â†’_(Pt)^(Î”)
```
and often required **extra spaces** to prevent Word mis-parsing subscripts/superscripts.

The new version must instead build an **AST** (Abstract Syntax Tree) representing structural elements (ions, groups, coefficients, states, arrows, etc.), and then convert the AST into Word UnicodeMath using well-defined conversion rules.

---

## ğŸŒ³ Key Requirements

### 1ï¸âƒ£ AST Parser
- Build a simple tokenizer to identify:
  - Elements (e.g., Na, Fe, Cu)
  - Numbers (for subscripts)
  - Parentheses `()`
  - Superscripts `^()`
  - Subscripts `_()`
  - Arrows `â†’`, `â‡Œ`, etc.
  - States `(s)`, `(l)`, `(g)`, `(aq)`
  - Labels above/below arrows (e.g. `â†’^(heat)`, `â†’_(Pt)`)
- Construct an AST that represents the structure of the full equation.

Example AST structure:
```
Reaction
 â”œâ”€â”€ Reactants
 â”‚   â”œâ”€â”€ Species: Na2SO4(aq)
 â”‚   â””â”€â”€ Species: BaCl2(aq)
 â”œâ”€â”€ Arrow: â†’
 â””â”€â”€ Products
     â”œâ”€â”€ Species: BaSO4(s)
     â””â”€â”€ Species: 2NaCl(aq)
```

---

### 2ï¸âƒ£ Conversion Rules for Word UnicodeMath

| Type | Syntax | Example |
|------|--------|----------|
| Subscript | `_()` + space | `H_2O ` |
| Superscript | `^()` + space | `SO_4^(2-) ` |
| Arrow | `â†’`, `â‡Œ`, `â†`, `â†”` | `A + B â†’ C` |
| Arrow label (top) | `â†’^(heat)` | heating condition |
| Arrow label (bottom) | `â†’_(Pt)` | catalyst |
| State symbols | base line (no `_()`) | `(s)`, `(l)`, `(aq)` |
| Grouped ions | `( )` preserved | `Fe(OH)_3` |
| Space rule | one space after each `_()` or `^()` | prevents mis-parsing |

---

### 3ï¸âƒ£ Auto Replacement for Common Ions and Compounds

| Input | Output |
|--------|---------|
| SO4 | `SO_4` |
| CO3 | `CO_3` |
| NO3 | `NO_3` |
| PO4 | `PO_4` |
| OH- | `OH^(-)` |
| Na+ | `Na^(+)` |
| H2O | `H_2O` |
| Fe(OH)3 | `Fe(OH)_3` |
| CuSO4 | `CuSO_4` |

Implement as a mapping dictionary (can be `.json` or `.js`) applied before AST parsing.

---

### 4ï¸âƒ£ Spacing Rules
After every `_()` or `^()`, always insert **one space** to clearly terminate the group.  
Example:
```
Fe(OH)_3 (s)
NaCl (aq)
SO_4^(2-)  (aq)
```
This ensures Word doesnâ€™t merge `(s)` or `(aq)` into subscripts.

---

### 5ï¸âƒ£ Arrow Label Normalization
Retain Word-compatible top/bottom syntax:
```
â†’^(Î”)
â†’_(Pt)
â†’_(Ni)^(Î”)
â‡Œ^(UV)
```
For custom arrow text:
```
\xrightarrow{heat} â†’ â–¡(â†’â”´heat )
```
and double-labeled arrows:
```
â†’_(Pt)^(heat)
```

---

### 6ï¸âƒ£ Chemical State Symbols
Keep `(s)`, `(l)`, `(g)`, `(aq)` **on the baseline**.  
Do **not** include them inside `_()` or `^()`.

Example:
```
Fe(OH)_3 (s)
H_2O (l)
NaCl (aq)
```

---

### 7ï¸âƒ£ Example Input & Output

Input:
```
Fe(OH)3(s) + 3HCl(aq) -> FeCl3(aq) + 3H2O(l)
```

Output (Word UnicodeMath):
```
Fe(OH)_3 (s) + 3HCl (aq) â†’ FeCl_3 (aq) + 3H_2O (l)
```

âœ… Works directly in Word Equation Editor  
âœ… Fully editable  
âœ… All subscripts/superscripts correct  
âœ… No extra spaces needed  

---

## ğŸ’¡ Summary
Replace the old regex conversion logic with an AST-based generator that:
1. Parses tokens and builds a tree of species, groups, states, and arrows.
2. Outputs valid Word UnicodeMath expressions using `_()` and `^()`.
3. Adds post-processing replacement for common ions/compounds.
4. Keeps design, layout, and UI fully unchanged.

---

### âš™ï¸ Deliverable
Produce a **single rewritten JavaScript file** (or module) that handles conversion using the AST logic.  
Do not modify any HTML, CSS, or UI behavior.

---

### ğŸ“„ Notes
- Maintain all current buttons and input fields.
- Add a small â€œcalculationâ€ bar with `\placeholder{}^\placeholder{}`, `\placeholder{}^2`, and `(a&b)` buttons.
- Keep spacing and brackets identical to original version.
- Test all features including rendering and button click logic.
