<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: \tfrac followed by \ln</title>
</head>
<body>
    <h1>Test: \tfrac followed by \ln spacing</h1>
    
    <div id="results"></div>

    <script type="module">
        import { parseLatex } from './js/latex-parser.js';
        import { printAST } from './js/ast-printer.js';

        const tests = [
            {
                name: "Test 1: \\tfrac{1}{k}\\ln",
                latex: "\\tfrac{1}{k}\\ln|g-kv^2|",
                expected: "1/k ln |g-kv^2|"
            },
            {
                name: "Test 2: Full expression from issue",
                latex: "\\int_{v_0^2}^{v^2}\\frac{d(v^2)}{g-kv^2}=\\Big[-\\tfrac{1}{k}\\ln|g-kv^2|\\Big]_{v_0^2}^{v^2}",
                expected: "∫_(v_0 ^2)^(v^2)▒(d(v^2 ))/(g-kv^2)=[-1/k ln |g-kv^2 |]_(v_0 ^2) ^(v^2)"
            },
            {
                name: "Test 3: \\frac{1}{k}\\ln (regular frac)",
                latex: "\\frac{1}{k}\\ln|x|",
                expected: "1/k ln |x|"
            },
            {
                name: "Test 4: \\tfrac{1}{k}\\log",
                latex: "\\tfrac{1}{k}\\log x",
                expected: "1/k log x"
            },
            {
                name: "Test 5: \\tfrac{1}{k}\\sin",
                latex: "\\tfrac{1}{k}\\sin x",
                expected: "1/k sin x"
            }
        ];

        const resultsDiv = document.getElementById('results');
        let allPassed = true;

        tests.forEach(test => {
            const ast = parseLatex(test.latex);
            const result = printAST(ast);
            const passed = result === test.expected;
            
            if (!passed) allPassed = false;

            const testDiv = document.createElement('div');
            testDiv.style.marginBottom = '20px';
            testDiv.style.padding = '10px';
            testDiv.style.border = passed ? '2px solid green' : '2px solid red';
            testDiv.style.backgroundColor = passed ? '#e8f5e9' : '#ffebee';
            
            testDiv.innerHTML = `
                <h3>${passed ? '✓' : '✗'} ${test.name}</h3>
                <p><strong>LaTeX:</strong> <code>${test.latex}</code></p>
                <p><strong>Expected:</strong> <code>${test.expected}</code></p>
                <p><strong>Got:</strong> <code>${result}</code></p>
                ${!passed ? `<p style="color: red;"><strong>FAILED</strong></p>` : ''}
            `;
            
            resultsDiv.appendChild(testDiv);
        });

        // Summary
        const summary = document.createElement('div');
        summary.style.marginTop = '20px';
        summary.style.padding = '15px';
        summary.style.backgroundColor = allPassed ? '#4caf50' : '#f44336';
        summary.style.color = 'white';
        summary.style.fontWeight = 'bold';
        summary.innerHTML = allPassed ? 'All tests passed!' : 'Some tests failed!';
        resultsDiv.appendChild(summary);

        console.log('Test Results:', tests.map((test, i) => {
            const ast = parseLatex(test.latex);
            const result = printAST(ast);
            return {
                test: test.name,
                passed: result === test.expected,
                expected: test.expected,
                got: result
            };
        }));
    </script>
</body>
</html>

