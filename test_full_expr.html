<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Debug Full Expression</title>
    <script src="js/symbol-maps.js"></script>
    <script src="js/ast-printer.js"></script>
    <script src="js/latex-parser.js"></script>
</head>
<body>
    <h1>Debug: Full Expression</h1>
    <pre id="output"></pre>
    
    <script>
        const latex = 'e^{i\\theta} = \\cos\\theta + i\\sin\\theta';
        console.log('Input:', latex);
        
        const ast = window.LatexParser.parse(latex);
        console.log('AST:', JSON.stringify(ast, null, 2));
        
        // Instrument the print function
        const originalPrint = window.ASTPrinter.print;
        let callCount = 0;
        window.ASTPrinter.print = function(ast) {
            callCount++;
            console.log(`\n=== Call ${callCount} ===`);
            console.log('AST:', ast);
            const result = originalPrint.call(this, ast);
            console.log('Result:', result);
            console.log('Result (spaces as ·):', result.replace(/ /g, '·'));
            return result;
        };
        
        const output = window.ASTPrinter.print(ast);
        console.log('\n=== FINAL OUTPUT ===');
        console.log('Output:', output);
        console.log('Output length:', output.length);
        console.log('Output with visible spaces:', output.replace(/ /g, '·'));
        
        // Check around "i sin"
        const iSinIndex = output.indexOf('i sin');
        if (iSinIndex !== -1) {
            console.log('\n=== Around "i sin" ===');
            const start = Math.max(0, iSinIndex - 5);
            const end = Math.min(output.length, iSinIndex + 10);
            const snippet = output.substring(start, end);
            console.log('Snippet:', snippet);
            console.log('Snippet (spaces as ·):', snippet.replace(/ /g, '·'));
            for (let i = start; i < end; i++) {
                console.log(`  [${i}] '${output[i]}' (${output.charCodeAt(i)})`);
            }
        }
        
        document.getElementById('output').textContent = 
            'Input: ' + latex + '\n\n' +
            'Output: "' + output + '"\n\n' +
            'Output length: ' + output.length + '\n\n' +
            'Output (spaces as ·): "' + output.replace(/ /g, '·') + '"\n\n' +
            'Check console for detailed logs';
    </script>
</body>
</html>

